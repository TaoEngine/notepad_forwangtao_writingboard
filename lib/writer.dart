part of 'notepad_forwangtao_writingboard.dart';

class _Writer extends CustomPainter {
  /// ä»åŸå§‹è§¦æ‘¸äº‹ä»¶è·å–åˆ°æ‰‹å†™ç¬”çš„å‚æ•°
  final StylusData stylusData;

  /// ç¬”çš„å±æ€§
  final PenProperties penProperties;

  /// åœ¨å•ä¸€çš„ä¸€ä¸ªä¹¦å†™ç»„ä»¶å†…æ˜¾ç¤ºçš„è½¨è¿¹
  ///
  /// åœ¨æ¯ä¸ªwidgetä¸­ï¼Œ
  /// ä¹¦å†™è½¨è¿¹ä¼šä»¥ [Path] çš„å½¢å¼ä¼ è¿‡æ¥
  /// è€Œåœ¨è¿™é‡Œéœ€è¦å¯¹ä¼ å…¥çš„å•ä¸ª [Path] è¿›è¡Œæ‹Ÿåˆå’Œé£æ ¼åŒ–å¤„ç†
  ///
  /// æ³¨æ„ä¼ å…¥çš„ [Path] éƒ½æ˜¯å›ºå®šçš„ï¼Œ
  /// å› æ­¤å¯¹äºç¬”è¿¹è¿›è¡Œæ‹Ÿåˆå’Œé£æ ¼åŒ–çš„æ“ä½œä¹Ÿåº”è¯¥æ˜¯å›ºå®šçš„ã€‚
  /// ç„¶ååŸå§‹è½¨è¿¹è¿˜éƒ½æ˜¯ä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„ï¼Œ
  /// åœ¨è¿™é‡Œå¹¶æ²¡æœ‰å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹ï¼Œ
  /// æ‰€ä»¥å¤§å¯ä¸ç”¨æ‹…å¿ƒé£æ ¼åŒ–ä¼šç ´ååŸå§‹è½¨è¿¹çš„æ ·å­
  final Path writingPath;

  /// æµ‹è¯•ç”¨ç”»æ¿ï¼Œä¸»è¦ç”¨äºæµ‹è¯•ä¹¦å†™çš„ç¬”è¿¹è¿›è¡Œè¿˜åŸçš„ç®—æ³•
  ///
  /// é¦–å…ˆï¼Œç”±äºFlutterçš„ç”»æ¿åœ¨ä½¿ç”¨æ—¶ä¼šè¿‡äºå¡é¡¿ï¼Œæˆ‘å¾—æƒ³ä¸ªåŠæ³•è§£å†³æ­¤ç±»å¡é¡¿
  ///
  /// å…¶æ¬¡ï¼Œç®€å•çš„ç”»ç¬”å¤„ç†å‡ºæ¥çš„ç¬”è¿¹å®åœ¨å¤ªä¸‘å•¦ï¼Œå¾—è®©ç¬”è¿¹æ‹Ÿåˆä¸€ä¸‹å¹¶å½¢æˆä¸€å®šçš„é£æ ¼ï¼Œ
  /// è¿™æ ·å†™å‡ºæ¥çš„å­—æ‰å¥½çœ‹
  ///
  /// æ­¤æ¬¡åˆ†ææˆ‘ä¸»è¦æ˜¯ä½¿ç”¨è¿™äº›æ–‡ç« è®²çš„è¿›è¡Œæ“ä½œ
  ///
  /// æ¶‰åŠç¬”è¿¹åˆ†æï¼šhttps://blog.csdn.net/luansxx/article/details/120960073
  ///
  /// æ¶‰åŠç¬”è¿¹æ‹Ÿåˆï¼šhttps://www.cnblogs.com/zl03jsj/p/8047259.html
  ///
  /// æ¶‰åŠç¬”è¿¹é£æ ¼åŒ–ï¼šhttps://cloud.tencent.com/developer/article/2364677
  ///
  /// è¿™æ˜¯æˆ‘ä¸ºäº†ç ”ç©¶æ­¤ç±»é—®é¢˜å¯¹ç”»æ¿è¿›è¡Œä¸€äº›ç®—æ³•ä¸Šçš„æ“ä½œï¼Œå®ƒä¸»è¦åšè¿™äº›äº‹æƒ…ï¼š
  /// - é¢„å¤„ç†ï¼Œæœ‰äº›è¿åœ¨ä¸€èµ·çš„ç‚¹å¯ä»¥ä¸è¦çš„ï¼Œè¦å¯¹ä»ç”»æ¿ä¸Šè·å–çš„ä¸€äº›ç‚¹è¿›è¡Œé¢„å¤„ç†ï¼Œ
  ///   æ‰¾åˆ°é‚£äº›æœ‰ä»·å€¼çš„ç‚¹
  ///
  /// - åˆ†æè½¬æŠ˜ç‚¹ï¼Œæœ‰ä¸€äº›å­—åœ¨ä¹¦å†™çš„æ—¶å€™ä¼šæœ‰ä¸€äº›æ‹å¼¯çš„åœ°æ–¹ï¼Œæ¯”å¦‚æŠ˜ï¼Œæ¨ªæŠ˜ï¼Œç«–é’©ç­‰ï¼Œ
  ///   è¿™äº›è½¬æŠ˜çš„åœ°æ–¹é€šå¸¸ä¼šä¸åŒäºå…¶ä»–åœ°æ–¹ï¼Œæ¯”å¦‚ç‚¹ä¼šå¯†é›†ä¸€äº›ã€‚
  ///   é€šè¿‡èšç±»çš„ç®—æ³•å¯ä»¥æ‰¾åˆ°è¿™äº›å¯†é›†çš„ç‚¹çš„ä½ç½®å¤§è‡´åœ¨å“ªï¼Œç„¶åå°±èƒ½æ‰¾åˆ°è¿™ä¸ªè½¬æŠ˜ç‚¹äº†
  ///
  /// - æ‹Ÿåˆæˆæ›²çº¿ï¼Œå¤§å®¶ç”¨æ¥æ‹Ÿåˆæ›²çº¿çš„åŠæ³•éƒ½æ˜¯è´å¡å°”æ›²çº¿å“ˆï¼Œé‚£æˆ‘ä¹Ÿä¸å®¢æ°”äº†ï¼
  ///
  /// - é£æ ¼åŒ–ï¼Œæˆ‘èŠ±äº†åŠä¸ªæœˆæƒ³åˆ°çš„æ–¹æ³•æ˜¯ï¼Œåœ¨æ¯ä¸ªé‡‡é›†ç‚¹ä¸Šåšä¸€ä¸ªåœ†ï¼Œé€šè¿‡å‹æ„Ÿå’Œé€Ÿåº¦æ¥è°ƒæ•´åœ†çš„åŠå¾„ï¼Œ
  ///   é€šè¿‡ç¦»è½¬æŠ˜ç‚¹çš„è¿œè¿‘æ¥è°ƒæ•´åœ†çš„åå¿ƒåº¦ï¼Œæœ€åå¡«å……ä¸€ä¸‹è½®å»“å³å¯ã€‚
  ///   ç»“æœæˆ‘åœ¨ç½‘ä¸Šæ‰¾èµ„æ–™çš„æ—¶å€™å‘ç°æ—©æœ‰äººè¿™ä¹ˆåšäº†ï¼Œè¿˜æœ‰æ›´å¥½å¤§ä½¬ç ”åˆ¶å‡ºçš„ä¼˜åŒ–ç‰ˆå‘¢ï¼
  ///   é‚£æˆ‘å¾—å¥½å¥½çš„å­¦ä¸€ä¸‹å“ˆ
  _Writer({
    required this.stylusData,
    required this.penProperties,
    required this.writingPath,
  });

  @override
  void paint(Canvas canvas, Size size) {
    Paint pen = Paint();

    // æ¯å¤„ç¬”è¿¹éœ€è¦æ–­å¼€
    pen.style = PaintingStyle.stroke;
    // ç¬”è¿¹æ•´ä½“å‘ˆåœ†æ»‘å‹
    pen.strokeCap = StrokeCap.round;
    // ç¬”è¿¹çš„è·¯å¾„å‘ˆåœ†æ»‘å‹
    pen.strokeJoin = StrokeJoin.round;
    // è®¾ç½®é¢œè‰²å’Œç²—ç»†
    pen.color = penProperties.penColor;
    pen.strokeWidth = penProperties.penSize;

    canvas.drawPath(writingPath, pen);
  }

  @override
  bool shouldRepaint(_Writer oldDelegate) => true;

  @override
  bool shouldRebuildSemantics(_Writer oldDelegate) => false;
}

/// ç¬”çš„å±æ€§
///
/// åœ¨ä¹¦å†™æ¿å»ºç«‹ä¹‹å‰å°†ä¸€äº›è¦ç”¨åˆ°çš„ç¬”å¼•å…¥ä¹¦å†™æ¿ï¼Œ
/// è¿™äº›ç¬”å°±ä¼šå‡ºç°åœ¨ä¹¦å†™æ¿çš„ç¬”ç›˜ä¸Š
/// ç¬”çš„è®¾ç½®æ ¹æ®å¤§å®¶å†™å­—çš„èˆ’é€‚åº¦æ¥è°ƒ
///
/// è®©æˆ‘ä»¬å°†éå¸¸å¥½çš„ç¬”ä»¬å¸¦ç»™å¤§å®¶ï¼ï¼ˆåä¸ºä½•åˆšéŸ³ï¼‰
class PenProperties {
  /// ç¬”çš„é¢œè‰²
  ///
  /// è¿™ä¸ªçœŸæ²¡å¤šå°‘å¥½è¯´çš„ğŸ¤“â˜ï¸ï¼Œ
  /// çœŸçš„å°±æ˜¯è°ƒæ•´ç¬”çš„é¢œè‰²
  final Color penColor;

  /// ç¬”çš„ç²—ç»†
  ///
  /// è°ƒæ•´ç¬”çš„ç²—ç»†åœ¨é‚£ä¸ªèŒƒå›´é—´å˜åŒ–
  ///
  /// ç²—ç»†ä¼šéšç€å‹æ„Ÿã€é€Ÿåº¦å’Œè§’åº¦å‡ºç°æˆ–å¤§æˆ–å°çš„å˜åŒ–ï¼Œ
  /// ä¸€èˆ¬æ¥è¯´ï¼Œ
  /// ç²—ç»†éš¾å˜åŒ–çš„ç¬”è¢«ç§°ä¸ºâ€œç¡¬ç¬”â€ï¼Œ
  /// è€Œå®¹æ˜“å˜åŒ–çš„ç¬”è¢«ç§°ä¸ºâ€œè½¯ç¬”â€
  final double penSize;

  /// å‹æ„Ÿæƒé‡
  ///
  /// åœ¨ä¹¦å†™æ—¶ï¼Œ
  /// å‹æ„Ÿå†³å®šç¬”è¿¹ç²—ç»†çš„é‡è¦ç¨‹åº¦ï¼Œ
  /// èŒƒå›´åœ¨0åˆ°1ä¹‹é—´
  ///
  /// è°ƒå¤§çš„è¯ç¬”ä¼šå‘è½¯ï¼Œè°ƒå°çš„è¯ç¬”ä¼šå‘ç¡¬
  final double penPressureWeight;

  /// ä¸­æ€§ç¬”é¢„è®¾
  ///
  /// æ‰‹æ„Ÿç¨ç¡¬ï¼Œä¸è¿‡è§‚æ„Ÿèˆ’æœ
  PenProperties.gelpen({
    this.penColor = Colors.black,
    this.penSize = 5,
    this.penPressureWeight = 0.1,
  });

  /// æ°´å½©ç¬”é¢„è®¾
  ///
  /// æ‰‹æ„Ÿç¨è½¯ï¼Œä¸è¿‡è¿˜æ²¡è½¯åˆ°æ¯›ç¬”çš„ç¨‹åº¦
  PenProperties.watercolorpen({
    this.penColor = Colors.red,
    this.penSize = 5,
    this.penPressureWeight = 0.8,
  });

  /// è‡ªå®šä¹‰ç¬”
  ///
  /// å¯ä»¥è®¾ç½®ç¬”çš„é¢œè‰²ï¼Œç²—ç»†ï¼Œè¿˜æœ‰å‹æ„Ÿ
  PenProperties(
    this.penColor,
    this.penSize,
    this.penPressureWeight,
  );
}

/// è·å–åˆ°çš„æ‰‹å†™ç¬”å‚æ•°
///
/// ä¸€èˆ¬æ¥è¯´ï¼Œæ‰‹å†™ç¬”æœ‰è¿™å‡ ä¸ªå‚æ•°å€¼å¾—æˆ‘ä»¬å…³æ³¨
/// - ç¬”çš„å‹æ„Ÿ
/// - ç¬”çš„è½¬å‘ï¼ˆåœ¨å±å¹•çš„ç›¸å¯¹æ–¹å‘ä¸Šï¼‰
/// - ç¬”çš„å€¾æ–œç¨‹åº¦
/// - ç¬”å°–åœ¨å±å¹•æŒ‰å‹å‡ºçš„é¢ç§¯ï¼ˆå¯èƒ½åœ¨ä¸€äº›è®¾å¤‡ä¸Šæ²¡æœ‰ï¼‰
class StylusData {
  /// æ‰‹å†™ç¬”çš„å‹æ„Ÿ
  final double stylusPressure;

  /// æ‰‹å†™ç¬”çš„è½¬å‘
  final double stylusDirection;

  /// æ‰‹å†™ç¬”çš„å€¾æ–œç¨‹åº¦
  final double stylusTilt;

  /// æ‰‹å†™ç¬”çš„æŒ‰å‹é¢ç§¯
  final double? stylusRadius;

  StylusData(
    this.stylusPressure,
    this.stylusDirection,
    this.stylusTilt,
    this.stylusRadius,
  );
}
